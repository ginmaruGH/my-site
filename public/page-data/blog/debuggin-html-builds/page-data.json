{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/debuggin-html-builds/","result":{"data":{"markdownRemark":{"id":"3190e89b-dd3b-568c-94ce-d49801234fff","html":"<p><a href=\"https://www.gatsbyjs.com/docs/debugging-html-builds/\">https://www.gatsbyjs.com/docs/debugging-html-builds/</a></p>\n<p>Errors while building static HTML files (the build-time React SSR process) generally happen for one of the following reasons:</p>\n<details open><summary>Google翻訳</summary><div>\n<p>静的HTMLファイルのビルド中のエラー（ビルド時のReact SSRプロセス）は、通常、次のいずれかの理由で発生します。\n</dvi></details></p>\n<p>&#x3C;1> Some of your code references “browser globals” like <code class=\"language-text\">window</code> or <code class=\"language-text\">document</code> that aren’t available in Node.js. If this is your problem you should see an error above like “window is not defined”. To fix this, find the offending code and either a) check before calling the code if window is defined so the code doesn’t run while Gatsby is building (see code sample below) or b) if the code is in the render function of a React.js component, move that code into a <a href=\"https://reactjs.org/docs/react-component.html#componentdidmount\"><code class=\"language-text\">componentDidMount</code> lifecycle</a> or into a <a href=\"https://reactjs.org/docs/hooks-reference.html#useeffect\"><code class=\"language-text\">useEffect</code> hook</a>, which ensures the code doesn’t run unless it’s in the browser.</p>\n<details open><summary>Google翻訳</summary><div>\n<ol>\n<li>\n<p>一部のコードは、Node.jsでは使用できない<code class=\"language-text\">window</code>や<code class=\"language-text\">document</code>などの“browser globals”を参照しています。\nこれが問題である場合は、“window is not defined”などのエラーが表示されるはずです。\nこれを修正するには、問題のあるコードを見つけて、</p>\n<p>a）Gatsbyのビルド中にコードが実行されないようにwindowが定義されているかどうかをコードを呼び出す前に確認します（以下のコードサンプルを参照）。</p>\n<p>b）コードがReact.jsコンポーネントのレンダリング関数にある場合、そのコードを<a href=\"https://reactjs.org/docs/react-component.html#componentdidmount\">componentDidMountライフサイクル</a>または<a href=\"https://reactjs.org/docs/hooks-reference.html#useeffect\">useEffectフック</a>に移動します。これにより、ブラウザにない限りコードが実行されなくなります。\n</dvi></details></p>\n</li>\n</ol>\n<p>&#x3C;2> Check that each of your JS files listed in your <code class=\"language-text\">pages</code> directory (and any sub-directories) are exporting either a React component or string. Gatsby treats any JS file listed under the <code class=\"language-text\">pages</code> dir as a page component, so it must have a default export that’s a component or string.</p>\n<details open><summary>Google翻訳</summary><div>\n<ol start=\"2\">\n<li><code class=\"language-text\">pages</code>ディレクトリ（およびサブディレクトリ）にリストされている各JSファイルがReactコンポーネントまたは文字列をエクスポートしていることを確認してください。\nGatsbyは、<code class=\"language-text\">pages</code>ディレクトリの下にリストされているJSファイルをページコンポーネントとして扱います。\nしたがって、コンポーネントまたは文字列であるデフォルトのエクスポートが必要です。\n</dvi></details></li>\n</ol>\n<p>&#x3C;3> You mix up <code class=\"language-text\">import</code> and <code class=\"language-text\">require</code> calls in the same file. This might lead to “WebpackError: Invariant Violation: Minified React error #130” since <a href=\"https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v1-to-v2/#convert-to-either-pure-commonjs-or-pure-es6\">webpack 4 is stricter than v3</a>. The solution is to only use <code class=\"language-text\">import</code> and this also extends to <code class=\"language-text\">gatsby-ssr</code> and <code class=\"language-text\">gatsby-browser</code> files.</p>\n<details open><summary>Google翻訳</summary><div>\n<ol start=\"3\">\n<li>同じファイルで<code class=\"language-text\">import</code>呼び出しと<code class=\"language-text\">require</code>呼び出しを混同します。\nこれにより、“WebpackError：Invariant Violation：Minified React error＃130”につながる可能性があります<a href=\"https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v1-to-v2/#convert-to-either-pure-commonjs-or-pure-es6\">webpack4はv3よりも厳密</a>。\n解決策は<code class=\"language-text\">import</code>のみを使用することであり、これは<code class=\"language-text\">gatsby-ssr</code>および<code class=\"language-text\">gatsby-browser</code>ファイルにも拡張されます。\n</dvi></details></li>\n</ol>\n<p>&#x3C;4> Your app doesn’t correctly <a href=\"https://reactjs.org/docs/react-dom.html\">hydrate</a> in the client, which results in gatsby develop and gatsby build being inconsistent. It’s possible that a change in a file like <code class=\"language-text\">gatsby-ssr</code> or <code class=\"language-text\">gatsby-browser</code> has a structure that is not reflected in the other file, meaning that there is a mismatch between client and server output.</p>\n<details open><summary>Google翻訳</summary><div>\n<ol start=\"4\">\n<li>アプリがクライアントで正しく<a href=\"https://reactjs.org/docs/react-dom.html\">ハイドレイト</a>されないため、gatsby developとgatsby buildの一貫性が失われます。\n<code class=\"language-text\">gatsby-ssr</code>や <code class=\"language-text\">gatsby-browser</code>のようなファイルの変更が、他のファイルに反映されていない構造を持っている可能性があります。\nこれは、クライアントとサーバーの出力に不一致があることを意味します。\n</dvi></details></li>\n</ol>\n<p>&#x3C;5> Some other reason :-) #1 is the most common reason building static files fail. If it’s another reason, you have to be a bit more creative in figuring out the problem.</p>\n<details open><summary>Google翻訳</summary><div>\n<ol start=\"5\">\n<li>他のいくつかの理由：-）＃1は、スタティックファイルの構築が失敗するもっとも一般的な理由です。\nべつの理由なら、あなたは問題を理解する上でもう少し創造的でなければなりません。\n</dvi></details></li>\n</ol>\n<hr>\n<h2 id=\"how-to-check-if-window-is-defined-br-（windowが定義されているかどうかを確認する方法）\" style=\"position:relative;\"><a href=\"#how-to-check-if-window-is-defined-br-%EF%BC%88window%E3%81%8C%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%EF%BC%89\" aria-label=\"how to check if window is defined br （windowが定義されているかどうかを確認する方法） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to check if <code class=\"language-text\">window</code> is defined <br />（<code class=\"language-text\">window</code>が定義されているかどうかを確認する方法）</h2>\n<p>When referencing <code class=\"language-text\">window</code> in a React component.</p>\n<details open><summary>Google翻訳</summary><div>\n<p>Reactコンポーネントで<code class=\"language-text\">window</code>を参照する場合。\n</dvi></details></p>\n<div class=\"filename\">JSX</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token comment\">// Check if window is defined (so if in the browser or in node.js).</span>\n<span class=\"token comment\">// windowが定義されているかどうかを確認（ブラウザまたはnode.jsの場合）</span>\n<span class=\"token keyword\">const</span> isBrowser <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> loggedIn <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isBrowser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span>localstorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"isLoggedIn\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"true\"</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Am I logged in? </span><span class=\"token punctuation\">{</span>loggedIn<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>When requiring a module:</p>\n<details open><summary>Google翻訳</summary><div>\n<p>モジュールが必要な場合：\n</dvi></details></p>\n<div class=\"filename\">JS</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Requiring a function causes an error during builds as the code tries to reference window</span>\n<span class=\"token comment\">// 関数を要求すると、コードがwindowを参照しようとするため、ビルド中にエラーが発生する</span>\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Error</span>\n<span class=\"token comment\">// Wrap the require in check for window</span>\n<span class=\"token comment\">// windowのチェックでrequireをラップする</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">undefined</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In case the module needs to be defined for the code to run, you can use a ternary operator</p>\n<details open><summary>Google翻訳</summary><div>\n<p>コードを実行するためにモジュールを定義する必要がある場合は、三項演算子を使用できます\n</dvi></details></p>\n<div class=\"filename\">JS</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">undefined</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">?</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"fixing-third-party-modules-br-（サードパーティモジュールの修正）\" style=\"position:relative;\"><a href=\"#fixing-third-party-modules-br-%EF%BC%88%E3%82%B5%E3%83%BC%E3%83%89%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E4%BF%AE%E6%AD%A3%EF%BC%89\" aria-label=\"fixing third party modules br （サードパーティモジュールの修正） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fixing third-party modules <br />（サードパーティモジュールの修正）</h2>\n<p>So, the worst has happened and you’re using an npm module that expects <code class=\"language-text\">window</code> to be defined. You may be able to file an issue and get the module patched, but what to do in the mean time?</p>\n<details open><summary>Google翻訳</summary><div>\n<p>このように、最悪の事態が発生し、 <code class=\"language-text\">window</code>が定義されることを期待するnpmモジュールを使用しています。\n問題を報告してモジュールにパッチを適用できる場合があります。しかし、その間に何をすべきでしょうか？\n</dvi></details></p>\n<p>One solution is to <a href=\"https://www.gatsbyjs.com/docs/how-to/custom-configuration/add-custom-webpack-config\">customize</a> your webpack configuration to replace the offending module with a dummy module during server rendering.</p>\n<details open><summary>Google翻訳</summary><div>\n<p>1つの解決策は、サーバーのレンダリング中に問題のモジュールをダミーモジュールに置き換えるようにwebpack構成を<a href=\"https://www.gatsbyjs.com/docs/how-to/custom-configuration/add-custom-webpack-config\">カスタマイズ</a>することです。\n</dvi></details></p>\n<p><code class=\"language-text\">gatsby-node.js</code> in the project root:</p>\n<details open><summary>Google翻訳</summary><div>\n<p>プロジェクトルートの <code class=\"language-text\">gatsby-node.js</code>：\n</dvi></details></p>\n<div class=\"filename\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> stage<span class=\"token punctuation\">,</span> loaders<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>stage <span class=\"token operator\">===</span> <span class=\"token string\">\"build-html\"</span> <span class=\"token operator\">||</span> stage <span class=\"token operator\">===</span> <span class=\"token string\">\"develop-html\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">bad-module</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n            use<span class=\"token operator\">:</span> loaders<span class=\"token punctuation\">.</span><span class=\"token function\">null</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Another solution is to use a package like <a href=\"https://github.com/gregberge/loadable-components\">loadable-components</a>. The module that tries to use <code class=\"language-text\">window</code> will be dynamically loaded only on the client side (and not during SSR).</p>\n<details open><summary>Google翻訳</summary><div>\n<p>別の解決策は、<a href=\"https://github.com/gregberge/loadable-components\">loadable-components</a>のようなパッケージを使用することです。\n<code class=\"language-text\">window</code>を使おうとするモジュールは、クライアント側でのみ動的にロードされます（SSR中はロードされません）。\n</dvi></details></p>\n<p><a href=\"https://github.com/gatsbyjs/gatsby/blob/master/docs/docs/debugging-html-builds.md\">Edit this page on GitHub</a></p>","fields":{"slug":"/gatsby-docs/debuggin-html-builds/"},"frontmatter":{"published":"2021-05-06T00:00:00.000Z","pubDate":"May 06, 2021","modified":"2021-05-07T00:00:00.000Z","modDate":"May 07, 2021","title":"Debugging HTML Build (HTMLビルドのデバッグ)","description":"Debugging HTML Build (HTMLビルドのデバッグ）についてGoogle翻訳をもとにまとめる。","tags":["Gatsby","GatsbyDocs","HowToGuides","LocalDevelopment","AdditionalGuides"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#683898","images":{"fallback":{"src":"/static/3f4376afad6ab1b8605d4dbb32f110c4/5aead/gatsby-icon.png","srcSet":"/static/3f4376afad6ab1b8605d4dbb32f110c4/e9fba/gatsby-icon.png 50w,\n/static/3f4376afad6ab1b8605d4dbb32f110c4/15e42/gatsby-icon.png 100w,\n/static/3f4376afad6ab1b8605d4dbb32f110c4/5aead/gatsby-icon.png 200w,\n/static/3f4376afad6ab1b8605d4dbb32f110c4/d6138/gatsby-icon.png 400w","sizes":"(min-width: 200px) 200px, 100vw"},"sources":[{"srcSet":"/static/3f4376afad6ab1b8605d4dbb32f110c4/dbc4a/gatsby-icon.webp 50w,\n/static/3f4376afad6ab1b8605d4dbb32f110c4/d8057/gatsby-icon.webp 100w,\n/static/3f4376afad6ab1b8605d4dbb32f110c4/2e34e/gatsby-icon.webp 200w,\n/static/3f4376afad6ab1b8605d4dbb32f110c4/416c3/gatsby-icon.webp 400w","type":"image/webp","sizes":"(min-width: 200px) 200px, 100vw"}]},"width":200,"height":200},"original":{"src":"/static/gatsby-icon-3f4376afad6ab1b8605d4dbb32f110c4.png","width":512,"height":512}}}}},"previous":null,"next":{"fields":{"slug":"/gatsby-docs/unit-testing/"},"frontmatter":{"title":"Unit Testing（ユニットテスト）","published":"2021-05-06T00:00:00.000Z","pubDate":"May 06, 2021","modified":"2021-05-07T00:00:00.000Z","modDate":"May 07, 2021"}}},"pageContext":{"id":"3190e89b-dd3b-568c-94ce-d49801234fff","previousPostId":null,"nextPostId":"5c0c5fdc-d491-54c1-88af-1ad18fa3a6e2"}},"staticQueryHashes":[]}